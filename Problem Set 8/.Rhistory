knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(data.table)
library(lmtest)
library(haven)
library(skedastic)
library(ivreg)
library(modelsummary)
library(tinytable)
library(ivmodel)
data_filtered <- data_trim %>% # "Filtered" refers to the conditions of Q4.
filter(adfe != 0 & adfe != 99, s == 2)
data <- read_dta("ee2002ext.dta")
p0050 = quantile(data$salfr, 0.005,  na.rm = TRUE)
p9950 = quantile(data$salfr, 0.995, na.rm = TRUE)
data_trim <- data %>%
filter(salfr > p0050 & salfr < p9950)
data_trim %>%
ggplot(mapping = aes(x = salfr)) +
geom_histogram(binwidth = 500, fill = 'lightblue3', color = 'lightblue4') +
theme(panel.background = element_rect(fill ="white"),
axis.line = element_line(size = 1,
colour ="gray",
linetype=1)) +
labs(x = "Income", y = "Count")
data_trim <- data_trim %>% # "Trim" refers to the removal of the percentiles in Q3.
mutate(agesq = agd^2)
data_filtered <- data_trim %>% # "Filtered" refers to the conditions of Q4.
filter(adfe != 0 & adfe != 99, s == 2)
data_filtered <- data_filtered %>%
mutate(lnw = log((salfr/4*hh)),
lnh = log(hh))
data_filtered <- do.call(data.frame,
lapply(data_filtered,
function(lnh) replace(lnh, is.infinite(lnh), NA)))
# Here I attempt to deal with some infinite values from our log hours variable.
model1 <- lm(lnw ~ agd + agesq +  adfe + lnh, data = data_filtered)
summary(model1)
data_filtered <- data_filtered %>%
filter(!is.na(lnw), !is.nan(lnw), !is.infinite(lnw))
model2 <- ivreg(lnw ~ agd + agesq + adfe + lnh |
as.factor(enf3) + as.factor(enf6) +
as.factor(enf18) + as.factor(tymen90r),
data = data_filtered)
summary(model2)
